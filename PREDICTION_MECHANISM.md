# é¢„æµ‹æœºåˆ¶å’Œ Prompt ç»„ç»‡è¯´æ˜

## 1. é¢„æµ‹æ–¹å¼ï¼šé€ä¸ªé¢„æµ‹ï¼ˆOne-by-Oneï¼‰

**å½“å‰å®ç°æ˜¯é€ä¸ªé¢„æµ‹ï¼Œä¸æ˜¯æ‰¹é‡é¢„æµ‹ã€‚**

### ä»£ç å®ç°

```31:59:agents/prediction_agent.py
for item in dataset:
    # æ„å»ºè¾“å…¥æ–‡æœ¬
    input_text = self._format_input(item)
    
    messages = [
        SystemMessagePromptTemplate.from_template(system_prompt),
        HumanMessagePromptTemplate.from_template(
            "Prompt: {prompt}\n\nè¾“å…¥æ•°æ®: {input_text}\n\nè¯·ç»™å‡ºé¢„æµ‹ç»“æœ:"
        )
    ]
    
    chat_prompt = ChatPromptTemplate.from_messages(messages)
    formatted_prompt = chat_prompt.format_messages(
        prompt=prompt,
        input_text=input_text
    )
    
    response = self.llm.invoke(formatted_prompt)
    prediction = response.content.strip()
    
    result = {
        **item,
        'prediction': prediction,
        'ground_truth': item.get('ground_truth', ''),
        'is_correct': self._check_correctness(prediction, item.get('ground_truth', ''))
    }
    results.append(result)
```

### ç‰¹ç‚¹

- âœ… **æ¯ä¸ª case å•ç‹¬è°ƒç”¨ä¸€æ¬¡ LLM API**
- âœ… **10 ä¸ª case ä¼šè°ƒç”¨ 10 æ¬¡ API**
- âœ… **æ¯æ¬¡è°ƒç”¨åªå¤„ç†ä¸€ä¸ªæ ·æœ¬**
- âœ… **å¯ä»¥ç‹¬ç«‹è·å–æ¯ä¸ªæ ·æœ¬çš„é¢„æµ‹ç»“æœ**

### æ‰§è¡Œæµç¨‹ç¤ºä¾‹ï¼ˆ10ä¸ªcaseï¼‰

```
Case 1: LLM APIè°ƒç”¨ â†’ é¢„æµ‹ç»“æœ1
Case 2: LLM APIè°ƒç”¨ â†’ é¢„æµ‹ç»“æœ2
Case 3: LLM APIè°ƒç”¨ â†’ é¢„æµ‹ç»“æœ3
...
Case 10: LLM APIè°ƒç”¨ â†’ é¢„æµ‹ç»“æœ10
```

## 2. Prompt ç»„ç»‡ç»“æ„

### 2.1 Prompt å±‚æ¬¡ç»“æ„

æ¯æ¬¡é¢„æµ‹è°ƒç”¨åŒ…å«ä¸¤å±‚ promptï¼š

1. **ç”¨æˆ·æä¾›çš„ Prompt**ï¼ˆä¼˜åŒ–çš„ç›®æ ‡ï¼‰
   - ä¾‹å¦‚ï¼šæ ‡é¢˜å…šåˆ†ç±»çš„ prompt
   - è¿™ä¸ª prompt ä¼šåœ¨æ¯æ¬¡è¿­ä»£ä¸­è¢«ä¼˜åŒ–å’Œæ”¹å†™

2. **ç³»ç»Ÿçº§åˆ«çš„ Prompt**ï¼ˆå›ºå®šçš„åŒ…è£…ï¼‰
   - ç”¨äºæŒ‡å¯¼ LLM å¦‚ä½•æ‰§è¡Œç”¨æˆ·æä¾›çš„ prompt

### 2.2 å®é™…çš„ LLM è°ƒç”¨æ ¼å¼

æ¯æ¬¡è°ƒç”¨ LLM æ—¶çš„æ¶ˆæ¯ç»“æ„ï¼š

```python
# System Message (å›ºå®š)
{
    "role": "system",
    "content": "ä½ æ˜¯ä¸€ä¸ªé¢„æµ‹åŠ©æ‰‹ã€‚æ ¹æ®ç»™å®šçš„ prompt å’Œè¾“å…¥æ•°æ®ï¼Œç”Ÿæˆé¢„æµ‹ç»“æœã€‚\nè¯·ä¸¥æ ¼æŒ‰ç…§ prompt çš„è¦æ±‚è¿›è¡Œé¢„æµ‹ã€‚"
}

# Human Message (åŠ¨æ€)
{
    "role": "user",
    "content": "Prompt: {ç”¨æˆ·æä¾›çš„prompt}\n\nè¾“å…¥æ•°æ®: {å•ä¸ªcaseçš„è¾“å…¥}\n\nè¯·ç»™å‡ºé¢„æµ‹ç»“æœ:"
}
```

### 2.3 å®Œæ•´ç¤ºä¾‹

å‡è®¾ï¼š
- **ç”¨æˆ·æä¾›çš„ prompt**ï¼ˆä¼šè¢«ä¼˜åŒ–çš„ï¼‰ï¼š
```
ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬åˆ†ç±»ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®æ–°é—»æ ‡é¢˜headlineé¢„æµ‹å…¶ Typography ç±»åˆ«æ˜¯å¦ä¸ºæ ‡é¢˜å…š

è¾“å…¥ï¼šä¸€ä¸ªæ–°é—»æ ‡é¢˜
è¾“å‡ºï¼š0 æˆ– 1ï¼ˆåªè¿”å›æ•°å­—ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—, 1 ä¸ºæ ‡é¢˜å…šï¼‰

è¯·ä»”ç»†åˆ†ææ ‡é¢˜çš„å†…å®¹ã€é£æ ¼å’Œç‰¹å¾ï¼Œç„¶åç»™å‡ºåˆ†ç±»ç»“æœã€‚
```

- **å•ä¸ª case çš„è¾“å…¥**ï¼š
```
"Daily life in RAJASTHAN, INDIA ğŸ‡®ğŸ‡³- CITY vs RURAL"
```

**å®é™…çš„ LLM è°ƒç”¨å†…å®¹**ï¼š

```
System: ä½ æ˜¯ä¸€ä¸ªé¢„æµ‹åŠ©æ‰‹ã€‚æ ¹æ®ç»™å®šçš„ prompt å’Œè¾“å…¥æ•°æ®ï¼Œç”Ÿæˆé¢„æµ‹ç»“æœã€‚
è¯·ä¸¥æ ¼æŒ‰ç…§ prompt çš„è¦æ±‚è¿›è¡Œé¢„æµ‹ã€‚

User: Prompt: ä½ æ˜¯ä¸€ä¸ªæ–‡æœ¬åˆ†ç±»ä¸“å®¶ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®æ–°é—»æ ‡é¢˜headlineé¢„æµ‹å…¶ Typography ç±»åˆ«æ˜¯å¦ä¸ºæ ‡é¢˜å…š

è¾“å…¥ï¼šä¸€ä¸ªæ–°é—»æ ‡é¢˜
è¾“å‡ºï¼š0 æˆ– 1ï¼ˆåªè¿”å›æ•°å­—ï¼Œä¸è¦åŒ…å«å…¶ä»–æ–‡å­—, 1 ä¸ºæ ‡é¢˜å…šï¼‰

è¯·ä»”ç»†åˆ†ææ ‡é¢˜çš„å†…å®¹ã€é£æ ¼å’Œç‰¹å¾ï¼Œç„¶åç»™å‡ºåˆ†ç±»ç»“æœã€‚

è¾“å…¥æ•°æ®: Daily life in RAJASTHAN, INDIA ğŸ‡®ğŸ‡³- CITY vs RURAL

è¯·ç»™å‡ºé¢„æµ‹ç»“æœ:
```

## 3. æ•°æ®æµç¨‹

### 3.1 æ•°æ®é›†åŠ è½½

æ•°æ®é›†ä» CSV/JSON/JSONL æ–‡ä»¶åŠ è½½ï¼Œæ¯ä¸ªæ ·æœ¬åŒ…å«ï¼š

```python
{
    'input': "æ–°é—»æ ‡é¢˜æ–‡æœ¬",           # è¾“å…¥å­—æ®µ
    'ground_truth': "1",              # æ ‡å‡†ç­”æ¡ˆï¼ˆç”¨äºéªŒè¯ï¼‰
    'itemId': "jxMuJYMZn7BCIg",      # å…¶ä»–å­—æ®µï¼ˆå¦‚æœæœ‰ï¼‰
    'Headline': "...",                # å…¶ä»–å­—æ®µ
    'Typography': "1"                 # å…¶ä»–å­—æ®µ
}
```

### 3.2 é¢„æµ‹è¿‡ç¨‹

```python
# è¾“å…¥
dataset = [
    {'input': "æ ‡é¢˜1", 'ground_truth': "1"},
    {'input': "æ ‡é¢˜2", 'ground_truth': "0"},
    ...
]

# å¯¹æ¯ä¸ªæ ·æœ¬å¾ªç¯å¤„ç†
for item in dataset:
    # 1. æå–è¾“å…¥æ–‡æœ¬
    input_text = item['input']  # "æ ‡é¢˜1"
    
    # 2. æ„å»º LLM è°ƒç”¨æ¶ˆæ¯
    messages = [
        system_message,  # å›ºå®šçš„ç³»ç»Ÿæç¤º
        user_message     # åŒ…å«ç”¨æˆ·prompt + input_text
    ]
    
    # 3. è°ƒç”¨ LLM
    response = llm.invoke(messages)
    prediction = response.content  # ä¾‹å¦‚: "1"
    
    # 4. éªŒè¯æ­£ç¡®æ€§
    is_correct = (prediction == item['ground_truth'])
    
    # 5. ä¿å­˜ç»“æœ
    result = {
        'input': "æ ‡é¢˜1",
        'prediction': "1",
        'ground_truth': "1",
        'is_correct': True
    }
```

### 3.3 è¾“å‡ºç»“æœ

```python
results = [
    {
        'input': "æ ‡é¢˜1",
        'prediction': "1",
        'ground_truth': "1",
        'is_correct': True
    },
    {
        'input': "æ ‡é¢˜2",
        'prediction': "0",
        'ground_truth': "0",
        'is_correct': True
    },
    ...
]
```

## 4. ä¼˜ç¼ºç‚¹åˆ†æ

### 4.1 å½“å‰æ–¹å¼ï¼ˆé€ä¸ªé¢„æµ‹ï¼‰çš„ä¼˜ç‚¹

âœ… **ç®€å•ç›´æ¥**ï¼šé€»è¾‘æ¸…æ™°ï¼Œæ˜“äºç†è§£å’Œè°ƒè¯•  
âœ… **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªæ ·æœ¬çš„é¢„æµ‹ç›¸äº’ç‹¬ç«‹ï¼Œä¸ä¼šç›¸äº’å½±å“  
âœ… **é”™è¯¯éš”ç¦»**ï¼šå•ä¸ªæ ·æœ¬å‡ºé”™ä¸ä¼šå½±å“å…¶ä»–æ ·æœ¬  
âœ… **çµæ´»**ï¼šå¯ä»¥ä¸ºæ¯ä¸ªæ ·æœ¬å®šåˆ¶å¤„ç†é€»è¾‘  

### 4.2 å½“å‰æ–¹å¼çš„ç¼ºç‚¹

âŒ **API è°ƒç”¨æ¬¡æ•°å¤š**ï¼š10 ä¸ª case éœ€è¦ 10 æ¬¡ API è°ƒç”¨  
âŒ **é€Ÿåº¦è¾ƒæ…¢**ï¼šä¸²è¡Œå¤„ç†ï¼Œæ€»æ—¶é—´ = å•æ¬¡æ—¶é—´ Ã— æ ·æœ¬æ•°  
âŒ **æˆæœ¬è¾ƒé«˜**ï¼šæ¯æ¬¡è°ƒç”¨éƒ½æœ‰åŸºç¡€å¼€é”€  

### 4.3 æ‰¹é‡é¢„æµ‹çš„æ½œåœ¨æ”¹è¿›

å¦‚æœè¦æ”¹ä¸ºæ‰¹é‡é¢„æµ‹ï¼Œå¯ä»¥ï¼š

1. **å°†æ‰€æœ‰æ ·æœ¬æ”¾åœ¨ä¸€ä¸ª prompt ä¸­**
   ```
   Prompt: {ç”¨æˆ·prompt}
   
   è¾“å…¥æ•°æ®:
   1. æ ‡é¢˜1
   2. æ ‡é¢˜2
   ...
   10. æ ‡é¢˜10
   
   è¯·å¯¹æ¯ä¸ªè¾“å…¥ç»™å‡ºé¢„æµ‹ç»“æœï¼Œæ ¼å¼ä¸ºï¼š1: é¢„æµ‹ç»“æœ1, 2: é¢„æµ‹ç»“æœ2, ...
   ```

2. **ä½¿ç”¨ LLM çš„ batch API**ï¼ˆå¦‚æœæ”¯æŒï¼‰
   - å°†å¤šä¸ªè¯·æ±‚æ‰“åŒ…å‘é€
   - åç«¯å¹¶è¡Œå¤„ç†
   - å‡å°‘ç½‘ç»œå»¶è¿Ÿ

## 5. æ€»ç»“

- **å½“å‰å®ç°**ï¼š10 ä¸ª case = 10 æ¬¡ç‹¬ç«‹çš„ LLM API è°ƒç”¨
- **Prompt ç»„ç»‡**ï¼š
  - System messageï¼šå›ºå®šçš„é¢„æµ‹åŠ©æ‰‹æç¤º
  - User messageï¼šç”¨æˆ·æä¾›çš„ prompt + å•ä¸ªæ ·æœ¬çš„è¾“å…¥æ•°æ®
- **ç”¨æˆ·æä¾›çš„ prompt** ä¼šè¢«åŒ…å«åœ¨æ¯æ¬¡è°ƒç”¨çš„ user message ä¸­
- **æ¯æ¬¡è¿­ä»£ä¼˜åŒ–çš„æ˜¯ç”¨æˆ·æä¾›çš„ prompt**ï¼Œç³»ç»Ÿçº§åˆ«çš„åŒ…è£…ä¿æŒä¸å˜

